global:
  imageRegistry: ""
  security:
    allowInsecureImages: true

image:
  registry: ""
  repository: postgres-pod
  tag: 17.2.0-ext
  pullPolicy: Never

auth:
  database: homelab
  username: server
  existingSecret: "postgres-secret"
  secretKeys:
    userPasswordKey: "server-db-password"
    adminPasswordKey: "postgres-password"

primary:
  pdb:
    create: true
    maxUnavailable: 1
    # Fix for linter: explicitly set unhealthyPodEvictionPolicy
    # Note: bitnami chart v18.3.0 uses this key
    unhealthyPodEvictionPolicy: "AlwaysAllow"
  
  podSecurityContext:
    enabled: true
    fsGroup: 1001
    fsGroupChangePolicy: Always
                
  containerSecurityContext:
    enabled: true
    readOnlyRootFilesystem: true
    allowPrivilegeEscalation: false
    runAsNonRoot: true
    runAsUser: 1001
    capabilities:
      drop:
        - ALL
                
  resources:
    requests:
      cpu: 50m
      memory: 200Mi
    limits:
      cpu: 200m
      memory: 400Mi
                  
  persistence:
    enabled: true
    storageClass: local-path
    size: 10Gi
                
  extraVolumes:
    - name: run-volume
      emptyDir: {}
  extraVolumeMounts:
    - name: run-volume
      mountPath: /var/run/postgresql
                  
  service:
    type: NodePort
    nodePorts:
      postgresql: 30432
                
readReplicas:
  enabled: false
                
volumePermissions:
  enabled: true
  image:
    registry: "registry-1.docker.io"
    repository: bitnami/os-shell
    digest: "sha256:2894a65763cafc20e72a1ed3176cfbcdabaa9cd77655e0c09f8f58852506c7b9"
  resources:
    limits:
      cpu: 100m
      memory: 128Mi
    requests:
      cpu: 10m
      memory: 64Mi
  containerSecurityContext:
    # Note: bitnami volumePermissions init container often needs root 
    # to perform chown on volume mounts.
    runAsUser: 0
    runAsNonRoot: false
    readOnlyRootFilesystem: true
